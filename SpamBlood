local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local remote = ReplicatedStorage:WaitForChild("remotes"):WaitForChild("unreliableReplication")
local LocalPlayer = Players.LocalPlayer

local ToggleValue = false

local function getRandomOtherPlayer(excludePlayer)
    local others = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= excludePlayer and p ~= LocalPlayer then
            table.insert(others, p)
        end
    end
    if #others > 0 then
        return others[math.random(1, #others)]
    end
    return nil
end

local function startWaterEffect()
    task.spawn(function()
        while ToggleValue do
            for _, target in ipairs(Players:GetPlayers()) do
                if target ~= LocalPlayer then
                    local char = target.Character or target.CharacterAdded:Wait()
                    local hrp = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart", 5)
                    if hrp then
                        for i = 1, 2 do
                            local fakeTarget = getRandomOtherPlayer(target)
                            if fakeTarget and fakeTarget.Character then
                                remote:FireServer("waterSplash", fakeTarget.Character, hrp.CFrame)
                            end
                        end
                    end
                end
            end
            task.wait()
        end
    end)
end

-- Auto restart on respawn
LocalPlayer.CharacterAdded:Connect(function()
    if ToggleValue then
        startWaterEffect()
    end
end)

-- GUI Button Only (Draggable)
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "1259851374"

local Button = Instance.new("TextButton", ScreenGui)
Button.Size = UDim2.new(0, 120, 0, 50)
Button.Position = UDim2.new(0, 100, 0, 100)
Button.Text = "Water: OFF"
Button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Button.TextColor3 = Color3.fromRGB(255, 255, 255)
Button.Active = true
Button.Draggable = true
Button.Visible = false

Button.MouseButton1Click:Connect(function()
    ToggleValue = not ToggleValue
    Button.Text = "Water: " .. (ToggleValue and "ON" or "OFF")
    if ToggleValue then
        startWaterEffect()
    end
end)
